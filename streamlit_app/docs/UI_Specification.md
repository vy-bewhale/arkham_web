# Спецификация Пользовательского Интерфейса (UI) для Arkham Client Streamlit App

**Дата:** {{YYYY-MM-DD}} <!-- Замени на текущую дату -->
**Версия:** 1.0

**1. Обзор**

Этот документ описывает дизайн пользовательского интерфейса для веб-приложения Streamlit, предназначенного для взаимодействия с библиотекой `arkham_client`. Цель — создать интуитивно понятный, функциональный и компактный интерфейс.

**2. Общая Структура Приложения**

Выбран **Вариант A: Боковая панель (`st.sidebar`) + Основная область**.

*   **Боковая панель (Sidebar):** Используется для размещения всех элементов управления фильтрами, параметров запроса и кнопки запуска операций (загрузка кеша, поиск транзакций).
*   **Основная область (Main Area):** Предназначена для отображения результатов (таблица транзакций), информационных сообщений, уведомлений и дополнительной информации о состоянии кеша.

**3. Стилизация для Компактности (CSS)**

Для достижения компактности интерфейса и уменьшения стандартных размеров элементов Streamlit будут применены пользовательские CSS-стили через `st.markdown(f"<style>{css_rules}</style>", unsafe_allow_html=True)`.
Основные цели стилизации:
*   Уменьшение общего размера шрифта приложения.
*   Уменьшение размеров шрифтов и отступов (padding) для виджетов: `st.text_input`, `st.number_input`, `st.selectbox`, `st.multiselect`, `st.button`.
*   Уменьшение высоты строк и отступов в ячейках таблиц, отображаемых через `st.dataframe`.
*   Примерные CSS правила (будут уточняться при разработке):
    ```css
    body, .stApp { font-size: 0.85rem !important; } /* Базовый шрифт */
    .stTextInput > div > div > input, 
    .stNumberInput > div > div > input,
    .stSelectbox > div > div { padding: 0.25rem 0.5rem !important; height: auto !important; font-size: 0.8rem !important; }
    .stMultiSelect > div > div > div > div { font-size: 0.8rem !important; padding: 0.1rem 0.3rem !important;}
    .stButton > button { padding: 0.25rem 0.75rem !important; font-size: 0.8rem !important; }
    .stDataFrame table { font-size: 0.75rem !important; }
    .stDataFrame th, .stDataFrame td { padding: 2px 5px !important; }
    ```

**4. Элементы Интерфейса и Их Расположение**

**4.1. Боковая Панель (`st.sidebar`)**

*   **Заголовок:** `st.sidebar.title("Фильтры и Параметры")`
*   **Секция "Настройки API и Кеша" (в `st.expander`, по умолчанию свернут):**
    *   `st.sidebar.button("Загрузить/Обновить данные для кеша")`: Кнопка для инициации загрузки/обновления кеша `arkham_client`.
    *   `lookback_cache = st.sidebar.selectbox("Период для кеша", ['24h', '7d', '30d'], index=1, help="Период для первоначальной загрузки данных в кеш")` (index=1 -> '7d').
    *   `min_usd_cache = st.sidebar.number_input("Мин. USD для кеша", min_value=0, value=10000, step=1000, help="Мин. сумма для транзакций при кешировании")`
    *   `limit_cache = st.sidebar.number_input("Лимит для кеша", min_value=1, max_value=5000, value=1000, step=100, help="Макс. кол-во транзакций для кеширования")`
*   **Секция "Основные Фильтры Транзакций":**
    *   Использование `st.sidebar.columns(2)` для компактного размещения:
        *   `min_usd = col1.number_input("Мин. сумма USD", min_value=0, value=1000000, step=10000, help="...")`
        *   `lookback = col2.selectbox("Период запроса", ['1h', '6h', '12h', '24h', '3d', '7d', '30d'], index=5, help="...")` (index=5 -> '7d').
    *   `token_symbols = st.sidebar.multiselect("Фильтр по токенам", options=[], help="Выберите символы токенов. Список формируется из кеша.")`
    *   `from_address_names = st.sidebar.multiselect("Фильтр по отправителю", options=[], help="Выберите имена/адреса отправителей. Список формируется из кеша.")`
    *   `to_address_names = st.sidebar.multiselect("Фильтр по получателю", options=[], help="Выберите имена/адреса получателей. Список формируется из кеша.")`
*   **Секция "Запрос Транзакций":**
    *   `limit_query = st.sidebar.number_input("Лимит транзакций в результате", min_value=1, max_value=1000, value=50, step=10)`
    *   `st.sidebar.button("Найти Транзакции")`: Основная кнопка для выполнения запроса.

**4.2. Основная Область (Main Area)**

*   **Уведомления и Статус:**
    *   При старте: Информация о загрузке API-ключа, предложение обновить кеш.
    *   Во время операций: `st.spinner("Загрузка...")`.
    *   Результаты операций: `st.success()`, `st.info()`, `st.warning()`, `st.error()`.
*   **Отображение Транзакций:**
    *   `st.header("Найденные транзакции")` (отображается, если есть результаты).
    *   `st.dataframe(transactions_df)`: Для отображения таблицы с транзакциями. Ключевые колонки: "Время", "Сеть", "Откуда", "Куда", "Символ", "Кол-во USD", "Хэш".
    *   `st.download_button("Скачать CSV", ...)`: Кнопка для выгрузки результатов, активна при наличии данных.
*   **Информация о Кеше (в `st.expander`):**
    *   `st.expander("Информация о кеше (адреса и токены)", expanded=False)`
        *   Текстовая информация: `st.write(f"Уникальных имен/адресов в кеше: {count}")`
        *   Кнопка для просмотра списка адресов (например, в `st.json` или `st.text_area`).
        *   Аналогично для токенов.

**5. Потоки Взаимодействия**

1.  **Запуск Приложения:**
    *   Автоматическая попытка загрузить API-ключ из `.env`.
    *   Отображение приветственного сообщения. Если кеш пуст, предложение его загрузить/обновить.
2.  **Загрузка/Обновление Кеша:**
    *   Пользователь открывает экспандер "Настройки API и Кеша" в сайдбаре.
    *   Задает параметры (период, мин. USD, лимит для кеша).
    *   Нажимает "Загрузить/Обновить данные для кеша".
    *   Отображается спиннер. По завершении — сообщение об успехе/ошибке и количестве загруженных элементов.
    *   Списки в `multiselect` фильтрах (токены, адреса) обновляются.
3.  **Фильтрация и Запрос Транзакций:**
    *   Пользователь задает критерии в "Основных Фильтрах Транзакций" и "Лимит транзакций в результате" в сайдбаре.
    *   Нажимает "Найти Транзакции".
    *   Отображается спиннер. По завершении — таблица с транзакциями в основной области или сообщение об отсутствии результатов.
4.  **Просмотр и Выгрузка Результатов:**
    *   Пользователь просматривает таблицу.
    *   Может скачать данные в CSV-формате.
5.  **Просмотр Содержимого Кеша:**
    *   Пользователь открывает экспандер "Информация о кеше" для просмотра статистики и списков.

**6. Особые Замечания**

*   **Динамическое Обновление Списков:** Списки для `st.multiselect` (токены, адреса) должны обновляться после каждой успешной загрузки/обновления кеша.
*   **Обработка Отсутствия Ключа API:** Если ключ не найден, приложение должно отобразить критическую ошибку и ограничить функциональность.
*   **Отсутствие "Выбрать все/Очистить":** Для первой версии решено не реализовывать кастомные кнопки "Выбрать все/Очистить" для `st.multiselect` для упрощения.

Этот документ будет служить руководством для разработчиков при реализации пользовательского интерфейса. 